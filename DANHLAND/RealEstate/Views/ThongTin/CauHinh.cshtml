@{
    ViewBag.Title = Resources.App.CauHinh;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Header{
    <div class="d-flex align-items-center flex-wrap mr-1">
        <button class="btn btn-icon mr-4" id="kt_aside_toggle">
            <span class="svg-icon svg-icon-xl">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <rect x="0" y="0" width="24" height="24" />
                        <path d="M2 11.5C2 12.3284 2.67157 13 3.5 13H20.5C21.3284 13 22 12.3284 22 11.5V11.5C22 10.6716 21.3284 10 20.5 10H3.5C2.67157 10 2 10.6716 2 11.5V11.5Z" fill="black" />
                        <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M9.5 20C8.67157 20 8 19.3284 8 18.5C8 17.6716 8.67157 17 9.5 17H20.5C21.3284 17 22 17.6716 22 18.5C22 19.3284 21.3284 20 20.5 20H9.5ZM15.5 6C14.6716 6 14 5.32843 14 4.5C14 3.67157 14.6716 3 15.5 3H20.5C21.3284 3 22 3.67157 22 4.5C22 5.32843 21.3284 6 20.5 6H15.5Z" fill="black" />
                    </g>
                </svg>
            </span>
        </button>
        <div class="d-flex align-items-baseline flex-wrap mr-5">
            <h5 class="text-dark font-weight-bold my-1 mr-5">@Resources.App.CauHinh</h5>
            <ul class="breadcrumb breadcrumb-transparent breadcrumb-dot font-weight-bold p-0 my-2 ">
                <li class="breadcrumb-item text-muted">
                    <a href="javascript:;" class="text-muted">@Resources.App.ThongTin</a>
                </li>

            </ul>
        </div>
    </div>
    @*<div class="d-flex align-items-center">
        <a href="javascript: void(0);" class="btn  btn-light-success hide font-weight-bolder mr-2" id="btn_restore">
            <i class="flaticon2-reply-1"></i> <span id="text-restore"></span>
        </a>
        <a href="javascript: void(0);" class="btn  btn-light-warning hide font-weight-bolder mr-2" id="btn_hiden">
            <i class="flaticon-medical"></i> <span id="text-antin"></span>
        </a>
        <a href="javascript: void(0);" class="btn  btn-light-danger hide font-weight-bolder mr-2" id="btn_delete">
            <i class="flaticon-delete"></i> <span id="text-delete"></span>
        </a>
        <button class="btn btn-primary font-weight-bolder" id="iAdd">
            <span class="svg-icon svg-icon-md">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <rect x="0" y="0" width="24" height="24"></rect>
                        <circle fill="#000000" cx="9" cy="15" r="6"></circle>
                        <path d="M8.8012943,7.00241953 C9.83837775,5.20768121 11.7781543,4 14,4 C17.3137085,4 20,6.6862915 20,10 C20,12.2218457 18.7923188,14.1616223 16.9975805,15.1987057 C16.9991904,15.1326658 17,15.0664274 17,15 C17,10.581722 13.418278,7 9,7 C8.93357256,7 8.86733422,7.00080962 8.8012943,7.00241953 Z" fill="#000000" opacity="0.3"></path>
                    </g>
                </svg>
            </span>@Resources.App.TaoDuAnMoi
        </button>
    </div>*@
}

<div class="row">

    <div class="col-lg-12">
        <div id="list_danh_sach"></div>
    </div>
</div>


@section ScriptsFile{
    <script src="~/Scripts/ckeditor-document.bundle.js"></script>
    <script src="~/Scripts/uppy.bundle.js"></script>
    <script src="~/Scripts/parsley.min.js"></script>
}
@section CustomScripts{
    <script type="text/javascript">
        $(function () {
            var wh = $(window).height();
            $('#list_danh_sach').height(wh - 200);
            loadCauHinh();
        });
        function loadCauHinh() {
            $.get("@Url.Action("GetCauHinh", "ThongTin")").done(function (rs) {
                $("#list_danh_sach").dxDataGrid({
                    dataSource: rs,
                    showRowLines: true,
                    rowAlternationEnabled: true,
                    showBorders: true,
                    hoverStateEnabled: true,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    keyExpr: "con_key",
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [10, 15, 20, 50, 100],
                        showInfo: true
                    },
                    editing: {
                        @*allowDeleting: "@bDel" == "True" ? true : false,
                        allowUpdating: "@bEdit" == "True" ? true : false,*@
                      //  allowDeleting :true,
                        allowUpdating:true,
                        mode: 'popup', // 'batch' | 'cell' | 'form' | 'row',
                        useIcons: true,
                        form: {
                            labelLocation: "top"
                        },
                        popup: {
                            title: "Thông Tin Cấu hình",
                            showTitle: true,
                            width: 700,
                            height: 525,
                            position: {
                                my: "top",
                                at: "top",
                                of: window
                            }
                        },
                        form: {
                            items: [{
                                itemType: "group",
                                colCount: 2,
                                colSpan: 2,
                                items: ["con_key", "con_value", {
                                    dataField: "GhiChu",
                                    editorType: "dxTextArea",
                                    colSpan: 2,
                                    editorOptions: {
                                        height: 50
                                    }
                                }]
                            }]
                        }
                   
                    },
                    selection: {
                        mode: "multiple"
                    },
                    columns: [
                        {
                        dataField: "con_key",
                        caption: "Từ khóa",
                        allowEditing: false, fixed: true,
                            width: 300,
                    },

                    {
                        dataField: "con_value",
                        caption: "Giá trị",
                        width:300,

                    },
                    {
                        dataField: "GhiChu",
                        caption: "Ghi chú"
                     },
                    ],
                    onRowUpdating: function (e) {
                        EditCauHinh(e.newData, e.key);
                    }
                });
            });
        }
        function EditCauHinh(item, id) {
            var data = {};
            data.__RequestVerificationToken = $('input[name="__RequestVerificationToken"]').val();
            data.key = id;
            var arryPropertyName = Object.getOwnPropertyNames(item);
            for (var i = 0; i < arryPropertyName.length; i++) {
                data[arryPropertyName[i]] = item[arryPropertyName[i]].toString()
            }
            $.post('@Url.Action("EditCauHinh", "ThongTin")', data).done(function (rs) {
                if (rs.rs_code == 1) {
                    ShowToast.success('Thành công', 3000);
                    loadCauHinh();
                }
                else {
                    loadCauHinh();
                    ShowToast.warning('Có lỗi xảy ra' + rs.rs_text, 3000);
                }

            }).fail(function () {
                LocDanhSach();
                alert("error");
            });
        }
    </script>
}